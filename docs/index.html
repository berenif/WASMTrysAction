<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0, user-scalable=yes"
    />
    <meta name="author" content="Dan Motzenbecker" />
    <meta
      name="description"
      content="Serverless WebRTC matchmaking for painless P2P"
    />
    <link href="images/favicon.png" rel="icon" type="image/png" />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Mono:ital@0;1&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="site.css" />
    <title>Trystero - serverless WebRTC matchmaking</title>
  </head>
  <body>
    <div id="canvas"></div>
    <canvas id="gameCanvas" width="800" height="400" style="display: none; border: 2px solid rgba(255,255,255,0.3); border-radius: 8px; background: rgba(0,0,0,0.8); box-shadow: 0 10px 30px rgba(0,0,0,0.5);"></canvas>
    <header>
      <h1>ü§ù Trystero<sup>0.21.8</sup></h1>
      <h2>Make any site multiplayer in a few lines.</h2>
      <h2>Serverless WebRTC matchmaking for painless P2P.</h2>

      <div>
        <div>
          <a href="https://github.com/dmotz/trystero">repo + docs</a>
        </div>
        <div id="room-num"></div>
      </div>
    </header>

    <main>
      <p>
        Below is some code describing what ºs happening on this site right now.
      </p>

      <p>
        Anyone on this page will connect directly to others in real-time,
        syncing cursor movement and clicks. Use your mouse or keyboard
        (WASD/ZQSD + Space) to control your cursor. (Try it, I dare you).
      </p>

      <div id="game-mode-toggle" style="margin: 20px 0; text-align: center;">
        <button id="toggle-game-btn" style="padding: 10px 20px; background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3); border-radius: 6px; cursor: pointer; font-family: inherit; font-size: 16px; transition: all 0.3s;">
          üéÆ Try WASM Game Mode with Collision Obstacles
        </button>
      </div>

      <div id="game-info" style="display: none; margin: 20px 0; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 8px;">
        <h3 style="color: #ffd700; margin-bottom: 10px;">üéØ WASM Game Features</h3>
        <p><strong>New!</strong> Experience real-time P2P gaming with WebAssembly-powered collision detection:</p>
        <ul style="list-style: none; padding: 0;">
          <li>‚Üí <strong>Arrow Keys/WASD:</strong> Move your player</li>
          <li>‚Üí <strong>Space:</strong> Jump over obstacles</li>
          <li>‚Üí <strong>Red Walls:</strong> Collision obstacles that block movement</li>
          <li>‚Üí <strong>Gold Coins:</strong> Collect to increase score</li>
        </ul>
        <p style="margin-top: 10px; color: #ffd700;">Players: <span id="game-players">1</span> | Score: <span id="game-score">0</span> | FPS: <span id="game-fps">0</span></p>
      </div>

      <p>
        Trystero can connect peers via
        <span
          >üåä
          <a href="https://en.wikipedia.org/wiki/BitTorrent">BitTorrent</a
          >,</span
        >
        <span>üê¶ <a href="https://en.wikipedia.org/wiki/Nostr">Nostr</a>,</span>
        <span>üì° <a href="https://en.wikipedia.org/wiki/MQTT">MQTT</a>,</span>
        <span
          >ü™ê
          <a href="https://en.wikipedia.org/wiki/InterPlanetary_File_System"
            >IPFS</a
          >,</span
        >
        <span
          ><span style="font-family: sans-serif">‚ö°Ô∏è</span>
          <a href="https://supabase.com">Supabase</a>,</span
        >
        and <span>üî• <a href="https://firebase.google.com">Firebase</a></span
        >.
      </p>

      <p id="peer-info">
        Right now you ºre the only person with the page open, but you can cheat
        and just open this URL in another tab to see what it ºs like with others.
      </p>

      <hr />

      <p>Here ºs how you use it.</p>

      <p>Join a room with an app ID and a room ID:</p>

      <pre><code>import {joinRoom} from 'trystero'
const room = joinRoom({appId: 'trystero-lounge'}, '101')
</code></pre>

      <p>
        Listen for peers joining and leaving (leaving out some boring UI code):
      </p>

      <pre><code>room.onPeerJoin(addCursor)
room.onPeerLeave(removeCursor)
</code></pre>

      <p>Make some actions to send and respond to:</p>

      <pre><code>const [sendMove, getMove] = room.makeAction('mouseMove')
const [sendClick, getClick] = room.makeAction('click')
</code></pre>

      <p>Broadcast your actions to other peers:</p>

      <pre><code>// Mouse controls
window.addEventListener('mousemove', e => sendMove([e.clientX, e.clientY]))
window.addEventListener('click', () => sendClick(randomFruit()))

// Keyboard controls (WASD/ZQSD)
window.addEventListener('keydown', e => {
  if (['w','a','s','d'].includes(e.key.toLowerCase())) {
    updatePosition(e.key)
    sendMove([x, y])
  }
  if (e.key === ' ') sendClick(randomFruit())
})
</code></pre>

      <p>And listen for when peers send theirs:</p>

      <pre><code>getMove(([x, y], peerId) => setCursorPosition(peerId, x, y))
getClick((fruit, peerId) => dropFruitFrom(peerId, fruit))
</code></pre>

      <p>
        That ºs all this page is doing, but you can do much more like audio/video
        streams and binary data (like files).
        <a href="https://github.com/dmotz/trystero#readme"
          >Peruse the readme to see how.</a
        >
      </p>

      <hr />

      <p>Want to add game logic with collision detection? Use the WASM game module:</p>

      <pre><code>// Initialize WASM game engine with collision obstacles
import {initGameEngine, createGameInstance} from 'trystero/game'

// Load your WASM game module
await initGameEngine('./game.wasm')

// Create a game instance with obstacles
const gameId = createGameInstance(room.id, {
  maxPlayers: 8,
  worldWidth: 800,
  worldHeight: 400,
  obstacles: [
    {x: 375, y: 100, width: 50, height: 200, type: 'wall'},
    {x: 200, y: 250, width: 100, height: 30, type: 'platform'}
  ]
})
</code></pre>

      <p>Handle collision detection and physics automatically:</p>

      <pre><code>// Process player actions with collision detection
room.onPeerJoin(peerId => addPlayer(gameId, peerId))

// Game actions respect obstacle collisions
const [sendAction, getAction] = room.makeAction('gameAction')
getAction((action, peerId) => {
  // WASM engine handles collision detection
  processGameAction(gameId, peerId, action)
})

// Update game physics at 60 FPS
const gameLoop = () => {
  const state = updateGame(gameId, 16.67) // ~60 FPS
  renderGameState(state) // Obstacles and collisions included
  requestAnimationFrame(gameLoop)
}
</code></pre>

      <hr />

      <p>
        -o-&lt;&lt;| <a href="https://oxism.com">Dan Motzenbecker</a> |
        <a href="https://github.com/dmotz">github/dmotz</a>
      </p>
    </main>
    <script src="site.js" type="module"></script>
  </body>
</html>
